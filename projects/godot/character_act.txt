extends Node2D

# 人物后台属性
@export var animationTree : AnimationTree
@export var animationState : AnimationNodeStateMachinePlayback
@export var face_left : bool = true
@export var face_vector : Vector2 = Vector2.LEFT
@export var ani_now : String = "idle"

# 需要控制的状态
#@onready var face_vector = Vector2.DOWN
#@onready var ani_next = "idle"

func _ready() -> void:
	animationTree = get_parent().get_node("AnimationTree")
	animationState = animationTree.get("parameters/playback")
	animationTree.active = true
	change_ani("idle", Vector2.UP)

func change_face(new_face_vector:Vector2):
	if new_face_vector.x < 0 and not face_left:
		scale.x = -scale.x
		face_left = true
	elif new_face_vector.x > 0 and face_left:
		scale.x = -scale.x
		face_left = false

# 传入：动画名称、动画方向(任意方向)
func change_ani(new_ani : String, new_face_vector = null):
	if not new_face_vector:
		new_face_vector = face_vector
	# 可循环动作，重复执行会跳过
	if (new_ani == "idle" or new_ani == "walk") and (new_ani == ani_now):
		return
	ani_now = new_ani
	face_vector = new_face_vector
	var anitreeblend = "parameters/"+ new_ani +"/blend_position"
	animationTree.set(anitreeblend, face_vector)
	animationState.travel(new_ani)
	change_face(new_face_vector)
